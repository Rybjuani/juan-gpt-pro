<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>JUAN_GPT // DEBUG_PRO</title>
    <style>
        :root { --neon: #00ff41; --danger: #ff003c; --bg: #000; --user: #00d4ff; --border: rgba(0, 255, 65, 0.3); }
        * { box-sizing: border-box; font-family: 'Courier New', monospace; }
        body { background: var(--bg); color: var(--neon); margin: 0; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        
        /* HEADER */
        header { padding: 10px; border-bottom: 1px solid var(--neon); font-size: 11px; display: flex; justify-content: space-between; background: #050505; }
        
        /* CONSOLA PRINCIPAL */
        #console { flex: 1; overflow-y: auto; padding: 15px; scroll-behavior: smooth; background: radial-gradient(circle, #0a0a0a 0%, #000 100%); }
        .msg { margin-bottom: 15px; padding: 10px; border-radius: 4px; }
        .u-msg { border-right: 3px solid var(--user); text-align: right; color: var(--user); }
        .a-msg { border-left: 3px solid var(--neon); background: rgba(0, 255, 65, 0.05); }
        
        /* LOG DE ERRORES (NUEVO) */
        #error-log { height: 80px; background: #110000; border-top: 1px solid var(--danger); color: var(--danger); font-size: 10px; padding: 10px; overflow-y: auto; white-space: pre-wrap; }

        /* CONTROLES */
        .controls { padding: 15px; display: flex; gap: 10px; background: #080808; border-top: 1px solid var(--border); }
        #query { flex: 1; background: #000; border: 1px solid var(--neon); color: var(--neon); padding: 12px; font-size: 16px; }
        .btn { padding: 10px 20px; font-weight: bold; cursor: pointer; border: 1px solid var(--neon); background: transparent; color: var(--neon); }
        .btn:hover { background: var(--neon); color: #000; }
        .btn-clr { border-color: var(--danger); color: var(--danger); }
        .btn-clr:hover { background: var(--danger); color: #fff; }

        .loading { animation: pulse 1s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }
    </style>
</head>
<body>

<header>
    <div>ST: <span id="st-text">IDLE</span></div>
    <div>MEM: <span id="mem-stat">0/15</span></div>
    <div>MODEL: <span id="mod-active">NONE</span></div>
</header>

<div id="console"></div>

<div id="error-log">>> SISTEMA DE LOGS INICIADO: Esperando eventos...</div>

<div class="controls">
    <button class="btn btn-clr" onclick="clearMem()">CLR</button>
    <input type="text" id="query" placeholder="Escribe aquí..." autocomplete="off">
    <button class="btn" onclick="exec()">ENVIAR</button>
</div>

<script>
    // TU API KEY ACTUALIZADA
    const K = "AIzaSyAyxCAogb6u_xlYSwfAY-ZSzo3YmxGiqNY";
    let chatHistory = [];
    
    // LISTA REPARADA SEGÚN TU PANEL
    // Eliminamos gemini-2.0-flash-exp porque es el que te está dando el error 404/Not Found.
    const MODELS = ["gemini-1.5-flash", "gemini-1.5-pro"];

    function debug(text) {
        const log = document.getElementById('error-log');
        log.innerText = `[${new Date().toLocaleTimeString()}] DEBUG: ${text}\n` + log.innerText;
    }

    function clearMem() {
        chatHistory = [];
        document.getElementById('console').innerHTML = "";
        document.getElementById('mem-stat').innerText = "0/15";
        debug("MEMORIA PURGADA POR EL USUARIO.");
    }

    async function exec() {
        const qInput = document.getElementById('query');
        const con = document.getElementById('console');
        const st = document.getElementById('st-text');
        const msg = qInput.value.trim();
        
        if(!msg) return;
        qInput.value = "";

        con.innerHTML += `<div class="msg u-msg"><b>TÚ:</b><br>${msg}</div>`;
        st.innerText = "BUSCANDO...";
        st.classList.add('loading');

        chatHistory.push({ role: "user", parts: [{ text: msg }] });
        if(chatHistory.length > 15) chatHistory.shift();
        document.getElementById('mem-stat').innerText = `${chatHistory.length}/15`;

        let success = false;

        for (let m of MODELS) {
            if(success) break;
            document.getElementById('mod-active').innerText = m.toUpperCase();
            debug(`Intentando conectar con núcleo: ${m}...`);

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${m}:generateContent?key=${K}`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ contents: chatHistory })
                });

                const data = await response.json();

                if (data.candidates && data.candidates[0].content) {
                    const reply = data.candidates[0].content.parts[0].text;
                    con.innerHTML += `<div class="msg a-msg"><b>JUAN_GPT:</b><br>${reply}</div>`;
                    chatHistory.push({ role: "model", parts: [{ text: reply }] });
                    success = true;
                    debug(`ÉXITO: Respuesta recibida desde ${m}.`);
                } else {
                    const errDetail = data.error ? data.error.message : "Error desconocido de Google.";
                    debug(`FALLO EN ${m}: ${errDetail}`);
                }
            } catch (e) {
                debug(`ERROR DE RED EN ${m}: ${e.message}`);
            }
        }

        if (!success) {
            con.innerHTML += `<div class="msg" style="color:var(--danger)">[FALLO CRÍTICO]: Ningún modelo respondió. Revisa el Log inferior.</div>`;
            debug("SISTEMA BLOQUEADO: Se recomienda usar el botón CLR.");
        }

        st.innerText = "READY";
        st.classList.remove('loading');
        con.scrollTop = con.scrollHeight;
    }

    document.getElementById('query').onkeypress = (e) => { if(e.key === 'Enter') exec(); };
</script>
</body>
</html>
